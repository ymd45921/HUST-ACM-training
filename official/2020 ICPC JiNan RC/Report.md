# 2020 ICPC 济南站 补题记录

比赛场上签了四个到，铁了。

## A - Matrix Equation

> 对于两个01矩阵 $A$ 和 $B$，指定矩阵运算符号 $\odot$ 和 $\times$ 的含义是：
> $$
> \begin{align}
> A \odot B = C \  &: \  C_{i, j} = A_{i, j} \and B_{i, j} \\\\
> A \times B = C \  &: \  C_{i, j} = \bigoplus_{k=1}^n A_{i,k} \and B_{k, j}
> \end{align}
> $$
>
> 现在给定01矩阵 $A$ 和矩阵 $B$，求满足算式 $A \times C = B \oplus C$ 且互不相同的01矩阵 $C$ 的个数取模。

比赛场上只想到了设 $C$ 的每一个单位然后高斯消元，答案就是 $2$ 的消元后矩阵的秩（基的数量）次数的幂对于给定的模数取模；但是这样做显然是不合理不科学的，时间复杂度直冲 $(n^2)^3$。

首先，这两种矩阵运算都是对于 $C$ 而言列独立的，所以显然是要将它分成每一列考虑：
$$
A \times C_{*, j} = B_{*, j} \odot C_{*, j}
$$
对于每一个具体的行 $i$ 展开上述的公式，得到下面的形式；该表达式的每一个 $i$ 都对应了矩阵 $B$ 和 $C$ 的第 $j$ 列的等式的值（一个列向量）的第 $i$ 行的值。
$$
i \in [1, n]: \  \bigoplus_{k=1}^n A_{i, k} \and C_{k, j} = B_{i, j} \and C_{i, j}
$$
省略选定的列编号 $j$，对于任意行号 $i$ 上面的公式可以写成下面这样，同样应该总是成立：
$$
\bigoplus_{k=1}^n A_{i, k} \and C_{k} = B_{i} \and C_{i}
$$
当 $B_i = 0$ 时，上式的右侧计算值为 $0$；否则，右侧计算值为 $C_i$，是未知项。此时，可以把未知项 $C_i$ 异或到上式左侧；因为异或运算具有交换律和结合律（本质上，异或是二进制的加法），所以可以将该未知项和左侧的异或子项 $A_{i, i} \and C_i$ 结合；又因为异或运算对于合取运算而言具有分配律，故该项可以写作 $(\lnot A_{i, i}) \and C_i$；综上所述，上式可以进一步改写：
$$
(\bigoplus_{k=1,\ k \neq i}^n A_{i, k} \and C_k)  \oplus (\lnot A_{i, i}) \and C_i = 0
$$
再综合 $B_i = 0$ 的情况，就可以得到下面的表示方法：
$$
(\bigoplus_{k=1}^n (A_{i, k} \oplus [(k = i) \and B_i]) \and C_k) = 0
$$
因为 $A$ 和 $B$ 都是预先给定的，所以每一项的左侧是固定的，通过合取符号和未知项联系起来；因此可以简单的将右侧的未知项 $C_k$ 的含义理解为是否取该列向量，以使得经过处理的列向量表达式的值为零向量。

现在回到整个列向量的水平上；我们现在将选定的未知矩阵 $C$ 的第 $j$ 列看作未知列向量，对于它的每一行 $i$ 都满足了上面推导的等式；我们设矩阵 $D$ 有 $D_{i, j} = A_{i, j} \oplus [(j = i) \and B_i]$，那么上面对于列向量每一行的表达式可以综合为自定义的矩阵乘法，写成如下形式：
$$
D \times C_{*,j} = \vec{0}
$$
对于这个简化后的矩阵高斯消元，得到的基的数量就是对于第 $j$ 列的贡献；答案显然只需要将每一列的贡献累加起来，就是最开始的暴力做法求出的矩阵的秩，从而就求出了答案。

当然，我们并没有写高斯消元的板子；此时就需要利用**线性代数**中学到的知识：

<font color="red">若矩阵 $A$ 和 $B$ 的乘积为零矩阵 $O$，则有 $r(A) + r(B) \leq n$</font>

矩阵的秩，也就是可以组成构成这个矩阵的行/列向量的极大线性无关组的大小；因为矩阵是 01 矩阵，我们可以使用**线性基**的板子，求出矩阵 $D$ 的线性基（最小线性无关组）的大小 $r(D)$，通过 $n - r(D)$ 求出未知矩阵（列向量）的极大线性无关组的大小 $r(C_{*, j})$，从而累加得到答案。

线性基单次插入向量的时间复杂度是 $O(n^2)$ 的，使用 `bitset` 可以保证较小的常数（$C \approx \frac{1}{32}$）；对于每一个列向量我们需要进行 $n$ 次插入，一共有 $n$ 组列向量，故总复杂度是 $O(n^4)$ 的，满足题目要求。

线性基的复杂度（$O(n^3)$）并不比高斯消元（$O(n^3)$）低；但是将问题分解为列向量之后，问题就变得可以通过方便且好写的线性基来解决了；对于每个列向量，我们使用高斯消元的复杂度大概是一样的。